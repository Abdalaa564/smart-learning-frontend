<div class="card shadow-sm">
    <div class="card-header bg-white py-3">
        <h5 class="mb-0 fw-bold">
            <i class="bi bi-calendar-check text-primary me-2"></i>Student Attendance
        </h5>
    </div>
    <div class="card-body">

        <!-- Filters Row -->
        <div class="row g-3 mb-4">
            <div class="col-md-4">
                <label class="form-label fw-semibold">Select Course</label>
                <select class="form-select" [(ngModel)]="selectedCourseId" (change)="onCourseChange()"
                    [disabled]="isLoadingCourses">
                    <option [ngValue]="null">Select a course...</option>
                    <option *ngFor="let c of courses" [value]="c.crs_Id">{{ c.crs_Name }}</option>
                </select>
            </div>

            <div class="col-md-4">
                <label class="form-label fw-semibold">Select Unit</label>
                <select class="form-select" [(ngModel)]="selectedUnitId" (change)="onUnitChange()"
                    [disabled]="!selectedCourseId || isLoadingUnits">
                    <option [ngValue]="null">Select a unit...</option>
                    <option *ngFor="let u of units" [value]="u.unit_Id">{{ u.unit_Name }}</option>
                </select>
            </div>

            <div class="col-md-4">
                <label class="form-label fw-semibold">Select Lesson</label>
                <select class="form-select" [(ngModel)]="selectedLessonId" (change)="onLessonChange()"
                    [disabled]="!selectedUnitId || isLoadingLessons">
                    <option [ngValue]="null">Select a lesson...</option>
                    <option *ngFor="let l of lessons" [value]="l.lesson_Id">{{ l.lesson_Name }}</option>
                </select>
            </div>
        </div>

        <hr class="my-4">

        <!-- Loading State -->
        <div *ngIf="isLoadingAttendance" class="text-center py-5">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="text-muted mt-2">Loading attendance list...</p>
        </div>

        <!-- Empty State -->
        <div *ngIf="!isLoadingAttendance && selectedLessonId && attendanceList.length === 0"
            class="text-center py-5 text-muted">
            <i class="bi bi-people display-4 mb-3 d-block"></i>
            <p class="mb-0">No students have checked in for this lesson yet.</p>
        </div>

        <!-- Prompt State -->
        <div *ngIf="!selectedLessonId" class="text-center py-5 text-muted">
            <i class="bi bi-cursor display-6 mb-3 d-block"></i>
            <p class="mb-0">Please select a course, unit, and lesson to view attendance.</p>
        </div>

        <!-- Attendance Table -->
        <div *ngIf="!isLoadingAttendance && attendanceList.length > 0" class="table-responsive">
            <table class="table table-hover align-middle">
                <thead class="table-light">
                    <tr>
                        <th scope="col">ID</th>
                        <th scope="col">Student Name</th>
                        <th scope="col">Email</th>
                        <th scope="col">Date</th>
                        <th scope="col">Check-In</th>
                        <th scope="col">Check-Out</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let student of attendanceList;">
                        <td>{{ student.studentId }}</td>
                        <td class="fw-bold">{{ student.fullName }}</td>
                        <td>{{ student.email }}</td>
                        <td>{{ student.attendanceDate | date:'mediumDate' }}</td>
                        <td>
                            <span class="badge bg-success bg-opacity-10 text-success border border-success px-2 py-1">
                                {{ student.checkIn | date:'shortTime' }}
                            </span>
                        </td>
                        <td>
                            <span *ngIf="student.checkOut"
                                class="badge bg-danger bg-opacity-10 text-danger border border-danger px-2 py-1">
                                {{ student.checkOut | date:'shortTime' }}
                            </span>
                            <span *ngIf="!student.checkOut" class="text-muted small">-</span>
                        </td>
                    </tr>
                </tbody>
            </table>
            <div class="mt-3 text-end text-muted small">
                Total Present: {{ attendanceList.length }}
            </div>
        </div>

    </div>
</div>