<div class="container py-4">

  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h3 class="fw-bold mb-1">Lessons for Unit #{{ unitId }}</h3>

      <p class="text-muted mb-0" *ngIf="unit">
        Unit: <strong>{{ unit.unit_Name }}</strong>
        <span *ngIf="unit.crs_Id" class="text-secondary ms-2">
          (Course #{{ unit.crs_Id }})
        </span>
      </p>
    </div>

    <div class="d-flex gap-2">
      <a
        class="btn btn-success btn-sm px-3"
        [routerLink]="['/Courses', courseId, 'units', unitId, 'lessons', 'add']">
        + Add Lesson
      </a>

      <a
        class="btn btn-secondary btn-sm px-3"
        [routerLink]="['/Courses', courseId, 'units']">
        ← Back to Units
      </a>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="isLoading" class="text-center my-5 fw-bold fs-5">
    Loading lessons...
  </div>

  <!-- Error -->
  <div *ngIf="!isLoading && errorMessage" class="alert alert-danger">
    {{ errorMessage }}
  </div>

  <!-- Empty -->
  <div *ngIf="!isLoading && !errorMessage && lessons.length === 0"
       class="alert alert-info text-center py-4">
    No lessons for this unit yet.
  </div>

  <!-- Lessons Cards -->
  <div *ngIf="!isLoading && !errorMessage && lessons.length > 0" class="row g-4">

    <div class="col-xl-4 col-lg-4 col-md-6 col-sm-12"
         *ngFor="let lesson of lessons">

      <div class="lesson-card shadow-sm rounded-3 overflow-hidden">

        <!-- Image -->
        <div class="lesson-image-wrapper text-center bg-light p-3">
          <img
            class="lesson-thumb"
            [src]="getPdfThumbnail(lesson)"
            alt="Lesson PDF thumbnail"
          />
        </div>

        <!-- Content -->
        <div class="lesson-content p-3">

          <div class="d-flex justify-content-between align-items-center mb-2">
            <span class="badge bg-primary">Lesson</span>
            <span class="text-muted small">#{{ lesson.lesson_Id }}</span>
          </div>

          <h5 class="fw-semibold mb-2">
            {{ lesson.lesson_Name }}
          </h5>

          <p class="text-muted small mb-3">
            {{ lesson.lessonDescription }}
          </p>

          <p class="text-secondary mb-3 small">
            <strong>Unit:</strong> {{ unit?.unit_Name }}
          </p>

          <!-- Section: Download + CRUD Icons -->
          <div class="d-flex justify-content-between align-items-center">

            <!-- Download PDF if available -->
            <div>
              <a
                *ngIf="getPdfDownloadUrl(lesson) as pdfUrl"
                [href]="pdfUrl"
                target="_blank"
                class="btn btn-outline-success btn-sm px-3 me-2"
                title="Download PDF">
                ⬇ PDF
              </a>

              <span *ngIf="!getPdfDownloadUrl(lesson)" class="text-muted small">
                No PDF available
              </span>
            </div>

            <!-- CRUD Icons -->
            <div class="d-flex gap-2">

              <!-- View Details -->
              <a
                class="btn btn-sm btn-outline-secondary"
                [routerLink]="[
                  '/Courses',
                  courseId,
                  'units',
                  unitId,
                  'lessons',
                  lesson.lesson_Id
                ]"
                title="View details">
                <i class="bi bi-eye"></i>
              </a>

              <!-- Edit -->
              <a
                class="btn btn-sm btn-outline-primary"
                [routerLink]="[
                  '/Courses',
                  courseId,
                  'units',
                  unitId,
                  'lessons',
                  lesson.lesson_Id,
                  'edit'
                ]"
                title="Edit lesson">
                <i class="bi bi-pencil"></i>
              </a>

              <!-- Create Quiz -->
              <a
                class="btn btn-sm btn-outline-warning"
                [routerLink]="[
                  '/lesson',
                  lesson.lesson_Id,
                  'create-quiz'
                ]"
                title="Create quiz for this lesson">
                <i class="bi bi-question-circle"></i>
              </a>

              <!-- Delete -->
              <a
                class="btn btn-sm btn-outline-danger"
                [routerLink]="[
                  '/Courses',
                  courseId,
                  'units',
                  unitId,
                  'lessons',
                  lesson.lesson_Id,
                  'delete'
                ]"
                title="Delete lesson">
                <i class="bi bi-trash"></i>
              </a>
            </div>

          </div>
          <!-- End of section -->

        </div>

      </div>

    </div>

  </div>

</div>
